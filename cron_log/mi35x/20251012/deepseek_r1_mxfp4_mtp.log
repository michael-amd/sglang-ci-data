[nightly] ==========================================
[nightly] SGL Nightly Benchmark Started
[nightly] ==========================================
[nightly] Command: perf_nightly.sh --model=deepseek --model-path=/data/models/amd-DeepSeek-R1-MXFP4-Preview --model-name=DeepSeek-R1-MXFP4-Preview --mode=online --hardware=mi35x --enable-mtp-test --teams-webhook-url=https://prod-99.westus.logic.azure.com/workflows/44b23afb37e74288b6b006c60bbe65b2/triggers/manual/paths/invoke?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=ucbP9AJ9WeZtxe95Wmi8TfLUjiEo0AZSZP4Y_cNgWS0
[nightly] Start time: 2025-10-12 14:00:01 PDT
[nightly] Machine: smci355-ccs-aus-m15-21.cs-aus.dcgpu
[nightly] Working directory: /mnt/raid/michael/sglang-ci
[nightly] Script location: /mnt/raid/michael/sglang-ci/perf_nightly.sh
[nightly] Process ID: 2370223
[nightly] ==========================================

[nightly] Runtime Environment:
[nightly] User: michaezh | Groups: michaezh spack everyone... | Docker: /usr/bin/docker
[nightly] Testing Docker daemon access...
[nightly] Docker daemon accessible - proceeding...
[nightly] Teams webhook URL provided via command line - notifications enabled
[nightly] DeepSeek MTP test enabled via command line
[nightly] Custom model path provided: /data/models/amd-DeepSeek-R1-MXFP4-Preview
[nightly] Hardware: mi35x, ROCM Version: rocm700
[nightly] Custom model name provided: DeepSeek-R1-MXFP4-Preview
[nightly] Model: deepseek, Mode(s): online
[nightly] Created process lock: /tmp/perf_nightly_deepseek.lock
[nightly] GPU is busy. Attempting to stop running Docker containers...
[nightly] Stopping running containers: e7c90318acf1
[nightly] Waiting 15s for GPU to become idle...
[nightly] WARN: GPU may still be busy, but proceeding as requested.
[nightly] Searching for non-SRT images for deepseek for the last 1 days...
[nightly] Searching for non-SRT mi35x image in 'rocm/sgl-dev' for date 20251012...
[nightly] No image found for today. Checking yesterday as a fallback...
[nightly] Searching for non-SRT mi35x image in 'rocm/sgl-dev' for date 20251011...
[nightly] Fallback found candidate tag: v0.5.3.post1-rocm700-mi35x-20251011
[nightly] Found local image: rocm/sgl-dev:v0.5.3.post1-rocm700-mi35x-20251011
[nightly] Successfully obtained fallback image for date 20251011: rocm/sgl-dev:v0.5.3.post1-rocm700-mi35x-20251011
[nightly] Found 1 valid image(s) to run benchmarks on:
[nightly]   - rocm/sgl-dev:v0.5.3.post1-rocm700-mi35x-20251011

[nightly] ==========================================
[nightly] Starting benchmarks for image: rocm/sgl-dev:v0.5.3.post1-rocm700-mi35x-20251011
[nightly] ==========================================
[nightly] Checking GPU status before starting benchmarks for rocm/sgl-dev:v0.5.3.post1-rocm700-mi35x-20251011...
[nightly] GPU is busy. Attempting to stop running Docker containers...
[nightly] Stopping running containers: 805c74b6ee9c
[nightly] Waiting 15s for GPU to become idle...
[nightly] WARN: GPU may still be busy, but proceeding as requested.
[nightly] Checking benchmark completion in: /mnt/raid/michael/sglang-ci/online/DeepSeek-R1-MXFP4-Preview/v0.5.3.post1-rocm700-mi35x-20251011_DeepSeek-R1-MXFP4-Preview_FP8_online
[nightly] Found 0 completed benchmark runs
[nightly] INFO: Found 0/15 completed runs for rocm/sgl-dev:v0.5.3.post1-rocm700-mi35x-20251011 (online). Proceeding with benchmarks.
[nightly] Using Docker image: rocm/sgl-dev:v0.5.3.post1-rocm700-mi35x-20251011
[nightly] Container name: sgl-dev_v0.5.3.post1-rocm700-mi35x-20251011
[nightly] Reusing container sgl-dev_v0.5.3.post1-rocm700-mi35x-20251011
[nightly] === Starting benchmark execution ===
[nightly] === Starting nightly DEEPSEEK online benchmark ===
[nightly] Launching deepseek_perf_online_csv.sh inside sgl-dev_v0.5.3.post1-rocm700-mi35x-20251011
[nightly] Passing --model-name='DeepSeek-R1-MXFP4-Preview' to DeepSeek benchmark
[nightly] Adding --enable-mtp-test flag for DeepSeek online benchmark
[mtp] MTP test enabled - setting runs per concurrency to 1
âœ… Parameter validation passed
[online] Script started at: 2025-10-12 14:00:37 PDT
Scanning existing logs to check if all benchmarks are already complete...
Checking GSM8K log status...
âœ… GSM8K log file is complete with final accuracy summary
Checking serving benchmark logs...
Scan complete: 5 total runs needed, 0 missing/incomplete
âœ… All benchmark logs (serving + GSM8K) are present and complete! No server startup needed.
Skipping server startup and benchmark execution - generating CSV from existing logs...
[online] Structured CSV initialized at /mnt/raid/michael/sglang-ci/online/DeepSeek-R1-MXFP4-Preview/v0.5.3.post1-rocm700-mi35x-20251011_DeepSeek-R1-MXFP4-Preview_FP8_online_mtp_test/v0.5.3.post1-rocm700-mi35x-20251011_DeepSeek-R1-MXFP4-Preview_FP8_serving_mtp_test.csv
Extracting metrics for concurrency 128 from existing logs...
[online] Updating CSV for concurrency 128: E2E=39943.26ms, TTFT=8024.16ms, ITL=26.42ms, Output=(tok/s): tok/s
[online] CSV updated with results for concurrency 128
Extracting metrics for concurrency 64 from existing logs...
[online] Updating CSV for concurrency 64: E2E=20345.33ms, TTFT=1156.33ms, ITL=20.12ms, Output=(tok/s): tok/s
[online] CSV updated with results for concurrency 64
Extracting metrics for concurrency 16 from existing logs...
[online] Updating CSV for concurrency 16: E2E=12329.51ms, TTFT=296.25ms, ITL=13.46ms, Output=(tok/s): tok/s
[online] CSV updated with results for concurrency 16
Extracting metrics for concurrency 4 from existing logs...
[online] Updating CSV for concurrency 4: E2E=9862.47ms, TTFT=216.31ms, ITL=11.15ms, Output=(tok/s): tok/s
[online] CSV updated with results for concurrency 4
Extracting metrics for concurrency 1 from existing logs...
[online] Updating CSV for concurrency 1: E2E=9039.03ms, TTFT=117.25ms, ITL=10.32ms, Output=(tok/s): tok/s
[online] CSV updated with results for concurrency 1
âœ… CSV generated from existing logs successfully.
Serving benchmark results written to /mnt/raid/michael/sglang-ci/online/DeepSeek-R1-MXFP4-Preview/v0.5.3.post1-rocm700-mi35x-20251011_DeepSeek-R1-MXFP4-Preview_FP8_online_mtp_test/v0.5.3.post1-rocm700-mi35x-20251011_DeepSeek-R1-MXFP4-Preview_FP8_serving_mtp_test.csv
Note: Both GSM8K and serving benchmarks were already complete
âœ… Serving benchmark completed successfully in 0 seconds (standard mode).
Structured serving benchmark results written to /mnt/raid/michael/sglang-ci/online/DeepSeek-R1-MXFP4-Preview/v0.5.3.post1-rocm700-mi35x-20251011_DeepSeek-R1-MXFP4-Preview_FP8_online_mtp_test/v0.5.3.post1-rocm700-mi35x-20251011_DeepSeek-R1-MXFP4-Preview_FP8_serving_mtp_test.csv
Individual concurrency logs saved to /mnt/raid/michael/sglang-ci/online/DeepSeek-R1-MXFP4-Preview/v0.5.3.post1-rocm700-mi35x-20251011_DeepSeek-R1-MXFP4-Preview_FP8_online_mtp_test/sglang_serving_benchmark_concurrency_*_run*.log
GSM8K accuracy results written to /mnt/raid/michael/sglang-ci/online/DeepSeek-R1-MXFP4-Preview/v0.5.3.post1-rocm700-mi35x-20251011_DeepSeek-R1-MXFP4-Preview_FP8_online_mtp_test/sglang_client_log_DeepSeek-R1-MXFP4-Preview_gsm8k.log
Shutting down SGLang server...
/mnt/raid/michael/sglang-ci/deepseek_perf_online_csv.sh: line 788: [: 0
0: integer expression expected
/mnt/raid/michael/sglang-ci/deepseek_perf_online_csv.sh: line 800: [: 0
0: integer expression expected
Server shutdown completed in 0 seconds

==========================================
SCRIPT EXECUTION SUMMARY
==========================================
Script completed at: 2025-10-12 14:00:37 PDT
Total execution time: 0 seconds (0 minutes)
Output directory: /mnt/raid/michael/sglang-ci/online/DeepSeek-R1-MXFP4-Preview/v0.5.3.post1-rocm700-mi35x-20251011_DeepSeek-R1-MXFP4-Preview_FP8_online_mtp_test
Serving CSV: /mnt/raid/michael/sglang-ci/online/DeepSeek-R1-MXFP4-Preview/v0.5.3.post1-rocm700-mi35x-20251011_DeepSeek-R1-MXFP4-Preview_FP8_online_mtp_test/v0.5.3.post1-rocm700-mi35x-20251011_DeepSeek-R1-MXFP4-Preview_FP8_serving_mtp_test.csv
Timing log: /mnt/raid/michael/sglang-ci/online/DeepSeek-R1-MXFP4-Preview/v0.5.3.post1-rocm700-mi35x-20251011_DeepSeek-R1-MXFP4-Preview_FP8_online_mtp_test/timing_summary_20251012_140037.log
===========================================
Cleaning up...
[nightly] === Online benchmark dispatched for DEEPSEEK; check logs in sgl-dev_v0.5.3.post1-rocm700-mi35x-20251011 ===
[nightly] === Starting post-processing (CSV processing, plot generation, Teams notifications) ===
[nightly] Processing online CSV data and generating plots... Logs will be saved to /mnt/raid/michael/sglang-ci/online/DeepSeek-R1-MXFP4-Preview/v0.5.3.post1-rocm700-mi35x-20251011_DeepSeek-R1-MXFP4-Preview_FP8_online/process_and_generate_online_plots.log
[nightly] Using plot date from image tag: 20251011
[nightly] Sending Teams notification for deepseek online plots...
[nightly] Adding benchmark date to Teams notification: 20251011
[nightly] Teams notification using plot directory: /mnt/raid/michael/sglang-ci/plots_server
[nightly] No GitHub credentials configured - using plot server links only
[nightly] To enable GitHub upload, set GITHUB_REPO and GITHUB_TOKEN environment variables
[nightly] Including intelligent analysis (7 days lookback)
[nightly] Adding --enable-mtp-test flag for Teams notification
ğŸ“¡ Plot server base URL: http://10.235.26.27:8000
ğŸ“ Plot directory: /mnt/raid/michael/sglang-ci/plots_server
ğŸ—‚ï¸  Benchmark directory: /mnt/raid/michael/sglang-ci
ğŸš€ MTP mode: Including DeepSeek R1 throughput artifacts
   No timing_summary log found for deepseek online on 20251012 - benchmark may not have run yet
   Found timing_summary log for deepseek online on 20251011: timing_summary_20251012_140037.log
   Found timing_summary log for deepseek online on 20251010: timing_summary_20251011_060043.log
ğŸ” Discovered 2 plot file(s) for deepseek online
   - 20251010_DeepSeek-R1-MXFP4-Preview_online.png -> http://10.235.26.27:8000/DeepSeek-R1-MXFP4-Preview/online/20251010_DeepSeek-R1-MXFP4-Preview_online.png
   - 20251010_DeepSeek-V3_online.png -> http://10.235.26.27:8000/DeepSeek-V3-0324/online/20251010_DeepSeek-V3_online.png
ğŸ” Analyzing benchmark results for accuracy and performance...
   Found timing_summary log for deepseek online on 20251011: timing_summary_20251012_140037.log
   Found timing_summary log for deepseek online on 20251011: timing_summary_20251012_140037.log
   Found timing_summary log for deepseek online on 20251011: timing_summary_20251012_140037.log
ğŸ” Sending adaptive card with plot links
ğŸ“Š Payload size: 0.00MB
âœ… Successfully sent Teams notification for deepseek online plots
   (Power Automate flow accepted - message processing asynchronously)
ğŸ‰ Teams notification sent successfully! (with intelligent analysis)
[nightly] Teams notification sent successfully for deepseek online
[nightly] === Online post-processing completed for DEEPSEEK ===
[nightly] ==========================================
[nightly] Completed benchmarks for image: rocm/sgl-dev:v0.5.3.post1-rocm700-mi35x-20251011
[nightly] Stopping container sgl-dev_v0.5.3.post1-rocm700-mi35x-20251011 to release resources...
[nightly] ==========================================
[nightly] ==========================================
[nightly] All benchmarks completed for 1 image(s)
[nightly] ==========================================
[nightly] Cleaning up process lock...
